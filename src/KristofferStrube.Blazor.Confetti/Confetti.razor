@using KristofferStrube.Blazor.DOM.Extensions
@using Microsoft.JSInterop
@implements IDisposable

<svg width="100%" height="100%" style="position:absolute;left:0;top:0;pointer-events:none;z-index:1000;">
    @foreach (var confettiPiece in confettiPieces)
    {
        <ConfettiAnimator @key=confettiPiece ConfettiPiece="confettiPiece" />
    }
    <defs>
        <filter id="filter0_ii_18_4033" x="2" y="4.55686" width="28.6" height="25.8863" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="0.6" dy="-0.6" />
            <feGaussianBlur stdDeviation="0.625" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.807843 0 0 0 0 0.176471 0 0 0 0 0.415686 0 0 0 1 0" />
            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_18_4033" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="0.6" dy="0.6" />
            <feGaussianBlur stdDeviation="0.625" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.796078 0 0 0 0 0.207843 0 0 0 0 0.301961 0 0 0 1 0" />
            <feBlend mode="normal" in2="effect1_innerShadow_18_4033" result="effect2_innerShadow_18_4033" />
        </filter>
        <filter id="filter1_f_18_4033" x="15.4566" y="6.31631" width="4.83139" height="8.94543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.25" result="effect1_foregroundBlur_18_4033" />
        </filter>
        <filter id="filter2_f_18_4033" x="11.6252" y="6.31631" width="4.83139" height="8.94543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.25" result="effect1_foregroundBlur_18_4033" />
        </filter>
        <linearGradient id="paint0_linear_18_4033" x1="16" y1="5.15686" x2="16" y2="29.8431" gradientUnits="userSpaceOnUse">
            <stop stop-color="#FF3F67" />
            <stop offset="1" stop-color="#F83BA1" />
        </linearGradient>
        <radialGradient id="paint1_radial_18_4033" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(10.5863 18.4047) rotate(-25.71) scale(20.7042 22.7813)">
            <stop offset="0.89097" stop-color="#FF657C" stop-opacity="0" />
            <stop offset="1" stop-color="#FF657C" />
        </radialGradient>
        <radialGradient id="paint2_radial_18_4033" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(14.8574 8.66919) rotate(-126.248) scale(4.35524 1.65175)">
            <stop stop-color="#FF5772" />
            <stop offset="1" stop-color="#FF5772" stop-opacity="0" />
        </radialGradient>
        <linearGradient id="paint3_linear_18_4033" x1="15.3913" y1="12.5948" x2="18.5004" y2="8.6692" gradientUnits="userSpaceOnUse">
            <stop stop-color="#FE375C" />
            <stop offset="1" stop-color="#FE375C" stop-opacity="0" />
        </linearGradient>
        <linearGradient id="paint4_linear_18_4033" x1="16.5219" y1="12.5948" x2="13.4128" y2="8.6692" gradientUnits="userSpaceOnUse">
            <stop offset="0.160784" stop-color="#FF5573" />
            <stop offset="1" stop-color="#FF5573" stop-opacity="0" />
        </linearGradient>


        <filter id="filter0_i_20020_3536" x="5.53656" y="6.66455" width="16.1382" height="23.3065" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="0.15" dy="-0.25" />
            <feGaussianBlur stdDeviation="0.25" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.701961 0 0 0 0 0.501961 0 0 0 0 0.454902 0 0 0 1 0" />
            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_20020_3536" />
        </filter>
        <filter id="filter1_f_20020_3536" x="7.31332" y="13.944" width="4.96973" height="6.74487" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.375" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <filter id="filter2_f_20020_3536" x="8.84172" y="10.4197" width="4.69421" height="6.19495" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.375" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <filter id="filter3_f_20020_3536" x="10.772" y="7.14734" width="5.51726" height="7.48071" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.375" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <filter id="filter4_ii_20020_3536" x="6.87466" y="1.97031" width="2.66244" height="3.25" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="-0.15" dy="0.15" />
            <feGaussianBlur stdDeviation="0.15" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.109804 0 0 0 0 0.580392 0 0 0 0 0.905882 0 0 0 1 0" />
            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_20020_3536" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="0.25" dy="-0.1" />
            <feGaussianBlur stdDeviation="0.2" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.0862745 0 0 0 0 0.317647 0 0 0 0 0.654902 0 0 0 1 0" />
            <feBlend mode="normal" in2="effect1_innerShadow_20020_3536" result="effect2_innerShadow_20020_3536" />
        </filter>
        <filter id="filter5_ii_20020_3536" x="3.6903" y="3.83789" width="3.15835" height="2.85776" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="-0.15" dy="0.15" />
            <feGaussianBlur stdDeviation="0.15" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.113725 0 0 0 0 0.568627 0 0 0 0 0.898039 0 0 0 1 0" />
            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_20020_3536" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="0.25" />
            <feGaussianBlur stdDeviation="0.2" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.0784314 0 0 0 0 0.341176 0 0 0 0 0.588235 0 0 0 1 0" />
            <feBlend mode="normal" in2="effect1_innerShadow_20020_3536" result="effect2_innerShadow_20020_3536" />
        </filter>
        <filter id="filter6_ii_20020_3536" x="2.1903" y="7.21594" width="3.4" height="2.51292" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="-0.15" dy="0.15" />
            <feGaussianBlur stdDeviation="0.15" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.113725 0 0 0 0 0.556863 0 0 0 0 0.87451 0 0 0 1 0" />
            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_20020_3536" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="0.25" />
            <feGaussianBlur stdDeviation="0.2" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.0941176 0 0 0 0 0.301961 0 0 0 0 0.603922 0 0 0 1 0" />
            <feBlend mode="normal" in2="effect1_innerShadow_20020_3536" result="effect2_innerShadow_20020_3536" />
        </filter>
        <filter id="filter7_ii_20020_3536" x="11.0511" y="5.58508" width="20.2218" height="24.355" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="1" dy="-1" />
            <feGaussianBlur stdDeviation="1" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.764706 0 0 0 0 0.501961 0 0 0 0 0.517647 0 0 0 1 0" />
            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_20020_3536" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="0.25" dy="-0.35" />
            <feGaussianBlur stdDeviation="0.3" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.780392 0 0 0 0 0.529412 0 0 0 0 0.509804 0 0 0 1 0" />
            <feBlend mode="normal" in2="effect1_innerShadow_20020_3536" result="effect2_innerShadow_20020_3536" />
        </filter>
        <filter id="filter8_f_20020_3536" x="12.2092" y="6.69177" width="18.9289" height="22.6885" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="1" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <filter id="filter9_f_20020_3536" x="11.8684" y="14.1249" width="7.18745" height="8.88806" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.625" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <filter id="filter10_f_20020_3536" x="13.5559" y="9.71863" width="8.75389" height="11.125" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.625" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <filter id="filter11_f_20020_3536" x="15.6497" y="6.52234" width="9.31152" height="12.363" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.625" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <filter id="filter12_f_20020_3536" x="19.4621" y="6.24988" width="7.87929" height="10.9482" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.625" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <filter id="filter13_f_20020_3536" x="26.4509" y="10.7118" width="3.93355" height="12.4518" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feGaussianBlur stdDeviation="0.625" result="effect1_foregroundBlur_20020_3536" />
        </filter>
        <radialGradient id="paint0_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(16.8046 27.6961) rotate(-93.8883) scale(21.6066 14.9828)">
            <stop stop-color="#97606B" />
            <stop offset="1" stop-color="#A87B67" />
        </radialGradient>
        <radialGradient id="paint1_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(19.2033 24.5407) rotate(-141.582) scale(9.81318 5.06726)">
            <stop stop-color="#8A564F" />
            <stop offset="1" stop-color="#8A564F" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint2_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(9.74042 16.6673) rotate(58.0919) scale(4.61566 1.79334)">
            <stop stop-color="#865645" />
            <stop offset="1" stop-color="#865645" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint3_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(9.92953 9.90554) rotate(84.6428) scale(3.01925 2.92551)">
            <stop stop-color="#B89174" />
            <stop offset="1" stop-color="#B48E70" stop-opacity="0" />
            <stop offset="1" stop-color="#B89174" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint4_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(11.5091 13.1449) rotate(58.6713) scale(5.76677 2.26463)">
            <stop stop-color="#865645" />
            <stop offset="1" stop-color="#865645" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint5_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(11.7718 7.09961) rotate(92.1622) scale(2.99948 2.97789)">
            <stop stop-color="#C6A180" />
            <stop offset="1" stop-color="#C6A180" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint6_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(14.3468 10.5748) rotate(56.2463) scale(7.9164 3.09735)">
            <stop stop-color="#865645" />
            <stop offset="1" stop-color="#865645" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint7_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(16.9169 5.32753) rotate(106.04) scale(4.45696 4.3873)">
            <stop stop-color="#B48E70" />
            <stop offset="1" stop-color="#B48E70" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint8_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(8.99142 16.0522) rotate(122.177) scale(3.94256 4.29422)">
            <stop stop-color="#A98367" />
            <stop offset="1" stop-color="#A98367" stop-opacity="0" />
        </radialGradient>
        <linearGradient id="paint9_linear_20020_3536" x1="11.1589" y1="19.5826" x2="7.06502" y2="15.1414" gradientUnits="userSpaceOnUse">
            <stop stop-color="#A98167" />
            <stop offset="1" stop-color="#A98167" stop-opacity="0" />
        </linearGradient>
        <linearGradient id="paint10_linear_20020_3536" x1="10.0918" y1="12.0098" x2="15.9853" y2="18.1702" gradientUnits="userSpaceOnUse">
            <stop stop-color="#BA9378" />
            <stop offset="1" stop-color="#BA9378" stop-opacity="0" />
        </linearGradient>
        <linearGradient id="paint11_linear_20020_3536" x1="12.8085" y1="7.72196" x2="19.1332" y2="14.5004" gradientUnits="userSpaceOnUse">
            <stop stop-color="#CDA587" />
            <stop offset="1" stop-color="#CDA587" stop-opacity="0" />
        </linearGradient>
        <radialGradient id="paint12_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(20.6619 15.0354) rotate(90) scale(14.9047 12.2669)">
            <stop stop-color="#DEA287" />
            <stop offset="1" stop-color="#EAAF9C" />
        </radialGradient>
        <radialGradient id="paint13_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(32.9166 21.7089) rotate(176.209) scale(6.07288 23.3151)">
            <stop stop-color="#DFA57D" />
            <stop offset="1" stop-color="#DFA57D" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint14_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(25.1001 15.8735) rotate(97.806) scale(14.8428 16.097)">
            <stop stop-color="#FFD0A8" />
            <stop offset="1" stop-color="#FFD0A8" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint15_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(13.0986 15.0782) rotate(102.538) scale(2.222 2.56895)">
            <stop stop-color="#CE9C7B" />
            <stop offset="1" stop-color="#CE9C7B" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint16_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(13.9811 15.1154) rotate(53.5658) scale(6.79917 2.41987)">
            <stop stop-color="#DF9F7C" />
            <stop offset="1" stop-color="#DF9F7C" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint17_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(14.1464 8.86628) rotate(71.222) scale(3.49228 5.58798)">
            <stop stop-color="#D1A281" />
            <stop offset="1" stop-color="#D1A281" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint18_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(15.301 11.2554) rotate(48.5275) scale(7.97563 2.8404)">
            <stop stop-color="#E6A480" />
            <stop offset="1" stop-color="#E6A480" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint19_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(17.3444 6.24336) rotate(90.6031) scale(3.66287 5.87108)">
            <stop stop-color="#D3A986" />
            <stop offset="1" stop-color="#D3A986" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint20_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(18.848 9.90595) rotate(49.8328) scale(9.38425 3.28726)">
            <stop stop-color="#D89A6E" />
            <stop offset="1" stop-color="#D89A6E" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint21_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(21.5468 5.8963) rotate(94.3996) scale(2.85716 4.2335)">
            <stop stop-color="#D7AC88" />
            <stop offset="1" stop-color="#D7AC88" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint22_radial_20020_3536" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(25.4212 14.5784) rotate(-89.0846) scale(6.20883 3.51252)">
            <stop offset="0.12411" stop-color="#B67D54" />
            <stop offset="1" stop-color="#D99D70" stop-opacity="0" />
        </radialGradient>
        <linearGradient id="paint23_linear_20020_3536" x1="28.4176" y1="12.5868" x2="28.4176" y2="21.2885" gradientUnits="userSpaceOnUse">
            <stop stop-color="#FFD0AB" />
            <stop offset="1" stop-color="#FFD0AB" stop-opacity="0" />
        </linearGradient>


        <filter id="filter0_iii_18_14837" x="0.827209" y="1.5" width="30.6728" height="29.6455" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dy="-0.5" />
            <feGaussianBlur stdDeviation="1.5" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.772549 0 0 0 0 0.494118 0 0 0 0 0.282353 0 0 0 1 0" />
            <feBlend mode="normal" in2="shape" result="effect1_innerShadow_18_14837" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="-1.25" dy="1.25" />
            <feGaussianBlur stdDeviation="0.75" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 0.952941 0 0 0 0 0.286275 0 0 0 1 0" />
            <feBlend mode="normal" in2="effect1_innerShadow_18_14837" result="effect2_innerShadow_18_14837" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
            <feOffset dx="1.5" dy="-0.5" />
            <feGaussianBlur stdDeviation="0.75" />
            <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
            <feColorMatrix type="matrix" values="0 0 0 0 0.698039 0 0 0 0 0.537255 0 0 0 0 0.192157 0 0 0 1 0" />
            <feBlend mode="normal" in2="effect2_innerShadow_18_14837" result="effect3_innerShadow_18_14837" />
        </filter>
        <radialGradient id="paint0_radial_18_14837" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(24.5421 8.96877) rotate(132.939) scale(19.9803 19.7731)">
            <stop stop-color="#FAC632" />
            <stop offset="1" stop-color="#F7C632" />
        </radialGradient>
        <radialGradient id="paint1_radial_18_14837" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(16.0386 15.9478) rotate(90) scale(13.9478 13.9614)">
            <stop stop-color="#DDBA38" />
            <stop offset="1" stop-color="#DDBA38" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint2_radial_18_14837" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(7.06005 10.0815) rotate(74.0546) scale(2.26515 7.5594)">
            <stop stop-color="#DDBA38" />
            <stop offset="1" stop-color="#DDBA38" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint3_radial_18_14837" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(2.07721 11.5205) rotate(16.0828) scale(3.93102 3.93486)">
            <stop stop-color="#B5953A" />
            <stop offset="1" stop-color="#B5953A" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint4_radial_18_14837" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(8.88802 30.8113) rotate(-58.4957) scale(2.82823 2.83099)">
            <stop stop-color="#C47E42" />
            <stop offset="1" stop-color="#C47E42" stop-opacity="0" />
        </radialGradient>
        <radialGradient id="paint5_radial_18_14837" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(31.0569 11.6761) rotate(150.751) scale(2.2288 2.93061)">
            <stop stop-color="#FFF246" />
            <stop offset="1" stop-color="#FFF246" stop-opacity="0" />
        </radialGradient>
    </defs>
</svg>

@code {
    private double width;
    private double height;
    private bool playing = false;

    [Inject]
    public required IJSRuntime JSRuntime { get; set; }

    [Inject]
    public required ConfettiService ConfettiService { get; set; }

    List<ConfettiPiece> confettiPieces = new();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        ConfettiService.Activated += HandleActivated;

        IJSObjectReference windowReference = await JSRuntime.InvokeAsync<IJSObjectReference>("window.valueOf");

        var helper = await JSRuntime.GetHelperAsync();
        width = await helper.InvokeAsync<double>("getAttribute", windowReference, "innerWidth");
        height = await helper.InvokeAsync<double>("getAttribute", windowReference, "innerHeight");
    }

    public record ClientRect(double x, double y, double width, double height);

    public async void HandleActivated(object? sender, ConfettiOptions options)
    {
        (double X, double Y)? originPosition = null;
        if (options.Origin is {} origin)
        {
            var helper = await JSRuntime.GetHelperAsync();
            var jSInstance = await helper.InvokeAsync<IJSObjectReference>("getJSReference", origin);
            var client = await jSInstance.InvokeAsync<ClientRect>("getBoundingClientRect");
            originPosition = (X: client.x + client.width / 2, Y: client.y + client.height / 2);
        }

        var newPieces = Enumerable
            .Range(0, options.Pieces)
            .Select(i =>
                new ConfettiPiece(
                    options.Type,
                    options.Colors[Random.Shared.Next(options.Colors.Length)],
                    options.Size + (int)((Random.Shared.NextDouble() * 2 - 1) * options.SizeVariation),
                    options.Milliseconds + (int)((Random.Shared.NextDouble() * 2 - 1) * options.VariationInMilliseconds),
                    options.Mode switch
                    {
                        ConfettiOriginMode.FromBottomCenter => FromBottomCenterPositions(),
                        ConfettiOriginMode.FromTopCurtain => FromTopCurtainPositions(),
                        ConfettiOriginMode.FromElement when originPosition is not null => FromElementPositions(originPosition.Value),
                        _ => FromBottomCenterPositions()
                    }
                )
            ).ToList();

        lock (confettiPieces)
        {
            confettiPieces.AddRange(newPieces);
        }

        StateHasChanged();
        await Task.Delay(options.Milliseconds + options.VariationInMilliseconds + 100);
        lock (confettiPieces)
        {
            confettiPieces = confettiPieces.Where(p => !newPieces.Contains(p)).ToList();
        }
        StateHasChanged();


    }

    private (double X, double Y)[] FromBottomCenterPositions()
    {
        var x = Random.Shared.NextDouble() - 0.5;
        var y = Random.Shared.NextDouble();
        var end = Random.Shared.NextDouble();
        return [(width / 2, height), (width / 2 + x * width / 3 * 2, height / 2 - y * height / 2), (width / 2 + x * width / 3 * 4, height + end * height / 3)];
    }

    private (double X, double Y)[] FromTopCurtainPositions()
    {
        var x = Random.Shared.NextDouble() * width;
        return [(x, 0), (x, height)];
    }

    private (double X, double Y)[] FromElementPositions((double x, double y) originPosition)
    {
        var x = Random.Shared.NextDouble() - 0.5;
        var y = Random.Shared.NextDouble();
        var end = Random.Shared.NextDouble();
        return [originPosition, (originPosition.x + x * width / 3 * 2, height / 2 - y * height / 2), (originPosition.x + x * width / 3 * 4, height + end * height / 3)];
    }

    public void Dispose()
    {
        ConfettiService.Activated -= HandleActivated;
    }
}
